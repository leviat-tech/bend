!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("bend",[],n):"object"==typeof exports?exports.bend=n():t.bend=n()}("undefined"!=typeof self?self:this,function(){return function(t){function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var e={};return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=0)}([function(t,n,e){"use strict";function r(t){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return i=function(){return t},t}function o(t){return u(t)||s(t)||f(t)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function u(t){if(Array.isArray(t))return l(t)}function p(t,n){return d(t)||y(t,n)||f(t,n)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t,n){if(t){if("string"==typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function y(t,n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(e.push(a.value),!n||e.length!==n);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return e}}function d(t){if(Array.isArray(t))return t}function h(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),e.push.apply(e,r)}return e}function m(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?h(Object(e),!0).forEach(function(n){v(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function v(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function g(t){var n=t.path,e=void 0===n?"":n,r=t.initialPosition,i=void 0===r?{x:0,y:0}:r,o=t.initialDirection,a=void 0===o?{x:1,y:0}:o;if(!(this instanceof g))return new g({path:e,initialPosition:i,initialDirection:a});this.path=e,this.initialPosition=(0,x.default)(i),this.initialDirection=(0,x.default)(a)}function b(t){return new g(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=b;var x=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var n=i();if(n&&n.has(t))return n.get(t);var e={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a)){var s=o?Object.getOwnPropertyDescriptor(t,a):null;s&&(s.get||s.set)?Object.defineProperty(e,a,s):e[a]=t[a]}return e.default=t,n&&n.set(t,e),e}(e(1)),w={d:function(t){var n=t.instructions,e=t.params,r=e.pop()/2;return n.unshift({type:"barRadius",radius:r}),{instructions:n,params:e}},s:function(t){var n=t.instructions,e=t.params,r=e.pop()/2;return n.push({type:"bendRadius",radius:r}),{instructions:n,params:e}},l:function(t){var n,e=t.instructions,r=t.params,i=parseFloat(r.pop()),o=e.length-1;return e[o]&&"turn"===e[o].type&&(n=i-e[o].shift),e[o]&&"bend"===e[o].type&&(n=i-e[o].lengthToTangent-e[o].shift),e.push({type:"forward",length:n||i,projectedLength:i}),{instructions:e,params:r}},w:function(t){for(var n=t.instructions,e=t.params,r=e.pop(),i=n.length-1,o=0,a=i;a>=0;a-=1)if("barRadius"===n[a].type){o=n[a].radius;break}for(var s=0,u=i;u>=0;u-=1)if("bendRadius"===n[u].type){s=n[u].radius+o;break}var p=0!==o?Math.abs(o*Math.tan((0,x.deg2rad)(r/2))):0;if(n[i].length-=p,0===s)n.push({type:"turn",angle:r,shift:p});else{var c=s/Math.tan((0,x.deg2rad)(180-Math.abs(r))/2);n[i].length-=c,n.push({type:"bend",angle:r,lengthToTangent:c,shift:p,radius:s})}return{instructions:n,params:e}},div:function(t){var n=t.instructions,e=t.params,r=e.pop(),i=e.pop();return e.push(i/r),{instructions:n,params:e}},atan:function(t){var n=t.instructions,e=t.params,r=e.pop();return e.push((0,x.rad2deg)(Math.atan(r))),{instructions:n,params:e}},neg:function(t){var n=t.instructions,e=t.params,r=e.pop();return e.push(-r),{instructions:n,params:e}}},j={barRadius:function(t){var n=t.pen,e=t.instruction;return{pen:m(m({},n),{},{barRadius:e.radius}),commands:null}},bendRadius:function(t){var n=t.pen,e=t.instruction;return{pen:m(m({},n),{},{bendRadius:e.radius}),commands:null}},forward:function(t){var n=t.pen,e=t.instruction,r=n.position.add(n.direction.scale(e.length));return{pen:m(m({},n),{},{position:r}),commands:[{type:"lineto",params:[r.x,r.y]}]}},bend:function(t){var n=t.pen,e=t.instruction,r=n.bendRadius||0,i=n.barRadius||0,o=r+i,a=n.direction.rotateDeg(e.angle),s=n.position.add(n.direction.scale(e.lengthToTangent)).add(a.scale(e.lengthToTangent)),u=e.angle>0?1:0,p=(0,x.default)(n.position).dist(s)/2,c=o-Math.sqrt(o*o-p*p),f=1===u?1:-1;return{pen:m(m({},n),{},{position:s,direction:a}),commands:[{type:"arcto",params:[s.x,s.y,f*(c/p)],svgParams:[o,o,0,0,u,s.x,s.y]}]}},turn:function(t){var n=t.pen,e=t.instruction;return{pen:m(m({},n),{},{direction:n.direction.rotateDeg(e.angle)}),commands:null}}},P=m(m({},j),{},{forward:function(t){var n=t.pen,e=t.instruction,r=n.position.add(n.direction.scale(e.projectedLength));return{pen:m(m({},n),{},{position:r}),commands:[{type:"lineto",params:[r.x,r.y]}]}},bend:function(t){var n=t.pen,e=t.instruction;return{pen:m(m({},n),{},{direction:n.direction.rotateDeg(e.angle)}),commands:null}}}),O=function(t){var n=(t.type,t.params);return{x:n[0],y:n[1]}},D=function(t){var n=t.type,e=t.params,r=t.svgParams,i=e.slice();return i.splice(1,1,-e[1]),"arcto"===n?{type:n,params:[e[0],-e[1],-e[2]],svgParams:[r[0],r[1],r[2],r[3],r[4]?0:1,r[5],-r[6]]}:{type:n,params:i}},M=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8;return Math.abs(t-n)<e},S=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8;return M(t.x,n.x,e)&&M(t.y,n.y,e)},L=function(t,n){var e=p(t,2),r=e[0],i=r.x,o=r.y,a=e[1],s=a.x,u=a.y,c=n.x,f=n.y,l=(c-i)/(s-i),y=(f-o)/(u-o),d=M(l,y),h=i<s?i<=c&&c<=s:s<=c&&c<=i,m=o<u?o<f&&f<=u:u<=f&&f<=o;return d&&h&&m},A=function(t,n){var e=[t[0],n[1]];return L(e,t[1])&&L(e,n[0])},E=function(t){return t.map(function(t){var n=t.type;return"".concat(t.params.join(" ")," ").concat(n)}).join(" ")},R=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t[0],i=null,o=[{type:"d",params:[n]},{type:"s",params:[e]}],a=1;a<t.length;a+=1){if(i){var s=(0,x.default)(t[a]).subtract(r),u=s.angleDeg()-i.angleDeg();o.push({type:"w",params:[u]}),i=s}else i=(0,x.default)(t[a]).subtract(r);o.push({type:"l",params:[i.magnitude()]}),r=t[a]}return E(o)};g.prototype.list=function(){return this.path.split(" ")},g.prototype.instructionList=function(){var t={instructions:[],params:[]};return this.list().forEach(function(n){w[n]?(t.instructions.push({type:n,params:t.params}),t.params=[]):t.params.push(n)}),t.instructions},g.prototype.stepPath=function(){var t=this.instructionList(),n=t.filter(function(t){return!["d","s"].includes(t.type)});return E(n)},g.prototype.instructions=function(){var t={instructions:[],params:[]};return this.list().forEach(function(n){w[n]?t=w[n](t):t.params.push(n)}),t.instructions},g.prototype.commands=function(){var t={position:this.initialPosition,direction:this.initialDirection},n=[{type:"moveto",params:[t.position.x,t.position.y]}];return this.instructions().forEach(function(e){var r=j[e.type]({pen:t,instruction:e}),i=r.pen,o=r.commands;o&&(n=n.concat(o)),t=i}),n},g.prototype.projectedCommands=function(){var t={position:this.initialPosition,direction:this.initialDirection},n=[{type:"moveto",params:[t.position.x,t.position.y]}];return this.instructions().forEach(function(e){var r=P[e.type]({pen:t,instruction:e}),i=r.pen,o=r.commands;o&&(n=n.concat(o)),t=i}),n},g.prototype.segments=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.invertY,e=void 0!==n&&n,r=e?this.commands().map(function(t){return D(t)}):this.commands(),i=O(r[0]),o=[];return r.slice(1).forEach(function(t){var n=O(t),e=(0,x.default)(n).subtract(i),r=(0,x.default)(i).add(e.scale(.5));o.push({type:t.type,points:[i,n],midpoint:r}),i={x:n.x,y:n.y}}),o},g.prototype.projectedSegments=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.invertY,e=void 0!==n&&n,r=e?this.projectedCommands().map(function(t){return D(t)}):this.projectedCommands(),i=O(r[0]),o=[];return r.slice(1).forEach(function(t){var n=O(t),e=(0,x.default)(n).subtract(i),r=(0,x.default)(i).add(e.scale(.5));o.push({type:t.type,points:[i,n],midpoint:r}),i={x:n.x,y:n.y}}),o},g.prototype.vertices=function(){var t=this.projectedSegments(),n=t.map(function(t){return t.points[0]}),e=t[t.length-1];return S(n[0],e.points[1])||n.push(e.points[1]),n},g.prototype.innerVertices=function(){var t=this.projectedSegments();return t.pop(),t.map(function(t){return t.points[1]})},g.prototype.bendInstructions=function(){return this.instructionList().filter(function(t){return"w"===t.type})},g.prototype.steps=function(){return this.instructions().reduce(function(t,n){if("forward"===n.type)t.push({length:n.projectedLength,termination:"cut"});else if(["bend","turn"].includes(n.type)){var e=t[t.length-1],r=t[0];e.termination="bend",e.sign=Math.sign(n.angle),e.angle=Math.abs(n.angle);var i=r&&"bend"===r.termination&&r.sign!==e.sign;e.turn=!!i}return t},[])},g.prototype.length=function(){return this.instructions().reduce(function(t,n){return"forward"===n.type?t+n.length:"bend"===n.type?t+Math.abs(n.radius*(0,x.deg2rad)(n.angle)):t},0)},g.prototype.bend=function(t,n,e){var r=this.projectedSegments(),i=this.instructionList(),o=r[t],a=i.filter(function(t){return"l"===t.type})[t],s=i.indexOf(a),u=(0,x.default)(o.points[0]).dist(o.points[1]),p=n*u,c=u-p;return i.splice(s,1,{type:"l",params:[p]},{type:"w",params:[e]},{type:"l",params:[c]}),new g({path:E(i),initialPosition:this.initialPosition,initialDirection:this.initialDirection})},g.prototype.toggleBend=function(t){var n,e=this.instructionList(),r=e.filter(function(t){return"w"===t.type}),i=r[t],o=e.indexOf(i),a=parseFloat(i.params[0]);return n=a>0?-90:a<0?0:90,e[o].params[0]=n,new g({path:E(e),initialPosition:this.initialPosition,initialDirection:this.initialDirection})},g.prototype.isBendStraight=function(t){var n=this.instructionList(),e=n.filter(function(t){return"w"===t.type}),r=e[t];return 0===parseFloat(r.params[0])},g.prototype.removeBend=function(t){var n,e,r,i=this.instructionList(),a=i.filter(function(t){return"w"===t.type}),s=a[t],u=i.indexOf(s),p=i[u-1],c=i[u+1],f="l"===p.type?parseFloat(p.params[0]):0,l="l"===c.type?parseFloat(c.params[0]):0;return p&&c?(n=[{type:"l",params:[f+l]}],e=u-1,r=3):p?(n=[p],e=u-1,r=2):c?(n=[c],e=u,r=2):(n=[],e=u,r=1),i.splice.apply(i,[e,r].concat(o(n))),new g({path:E(i),initialPosition:this.initialPosition,initialDirection:this.initialDirection})},g.prototype.setSegmentLength=function(t,n){var e=this.instructionList(),r=e.filter(function(t){return"l"===t.type}),i=r[t];return e[e.indexOf(i)].params[0]=n,new g({path:E(e),initialPosition:this.initialPosition,initialDirection:this.initialDirection})},g.prototype.setBendAngle=function(t,n){var e=this.instructionList(),r=e.filter(function(t){return"w"===t.type}),i=r[t];return e[e.indexOf(i)].params[0]=n,new g({path:E(e),initialPosition:this.initialPosition,initialDirection:this.initialDirection})},g.prototype.reverse=function(){for(var t,n=this.projectedSegments(),e=n[n.length-1],r=e.points[1],i=(0,x.default)(e.points[0]).subtract(e.points[1]).normalize(),a=this.instructionList().reverse().map(function(t){var n=t.type,e=t.params;return{type:n,params:"w"===n?[-parseFloat(e[0])]:e}}),s=function(t){return["d","s"].includes(t.type)?"a":"b"},u=a.reduce(function(t,n){if(0===t.length)return t.push([n]),t;var e=t[t.length-1][0];return s(n)===s(e)?t[t.length-1].push(n):t.push([n]),t},[]),p=0;p<u.length;p+=1){var c=u[p];"a"===s(c[0])&&(u[p]=u[p-1],u[p-1]=c)}var f=(t=[]).concat.apply(t,o(u));return new g({path:E(f),initialPosition:r,initialDirection:i})},g.prototype.join=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start",r="end"===n?this:this.reverse(),i="start"===e?t:t.reverse(),o=r.vertices(),a=[o[o.length-2],o[o.length-1]],s=i.vertices(),u=[s[0],s[1]],p=S(o[o.length-1],s[0]),c=A(a,u);p&&!c?o.pop():c&&(o.pop(),s.shift());var f=r.instructionList(),l=o.concat(s),y=f.find(function(t){return"d"===t.type}),d=y?y.params[0]:0,h=f.find(function(t){return"s"===t.type}),m=h?h.params[0]:0;return new g({path:R(l,d,m),initialPosition:o[0],initialDirection:r.initialDirection})},g.prototype.print=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.invertY,e=void 0!==n&&n,r={moveto:"M",lineto:"L",arcto:"A"};return this.commands().map(function(t){var n=t;e&&(n=D(t));var i="arcto"===n.type?n.svgParams:n.params;return[r[t.type]].concat(o(i)).join(" ")}).join(" ")}},function(t,n,e){!function(n,e){t.exports=e()}("undefined"!=typeof self&&self,function(){return function(t){function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var e={};return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="",n(n.s=0)}([function(t,n,e){"use strict";function r(t){return t*(Math.PI/180)}function i(t){return t*(180/Math.PI)}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.x,e=t.y;if(!(this instanceof o))return new o({x:n,y:e});this.x=n||0,this.y=e||0}function a(t){return new o(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=a,n.deg2rad=r,n.rad2deg=i,o.prototype.cross=function(t){return this.x*t.y-this.y*t.x},o.prototype.dot=function(t){return this.x*t.x+this.y*t.y},o.prototype.divide=function(t){return new o({x:this.x/t.x,y:this.y/t.y})},o.prototype.magnitude=function(){return Math.sqrt(this.dot({x:this.x,y:this.y}))},o.prototype.length=function(){return this.magnitude()},o.prototype.add=function(t){return new o({x:this.x+t.x,y:this.y+t.y})},o.prototype.subtract=function(t){return new o({x:this.x-t.x,y:this.y-t.y})},o.prototype.midpoint=function(t){var n=this.subtract(t).reverse(),e=n.scale(.5);return this.add(e)},o.prototype.scale=function(t){return new o({x:this.x*t,y:this.y*t})},o.prototype.multiplyScalar=function(t){return this.scale(t)},o.prototype.angle=function(){return Math.atan2(this.y,this.x)},o.prototype.angleDeg=function(){return i(this.angle())},o.prototype.angleBetween=function(t){var n=new o(t);return Math.acos(this.dot(n)/(this.magnitude()*n.magnitude()))},o.prototype.angleBetweenDeg=function(t){return i(this.angleBetween(t))},o.prototype.reverse=function(){return new o({x:-this.x,y:-this.y})},o.prototype.invert=function(){return this.reverse()},o.prototype.normalize=function(){var t=this.magnitude();return t<=0?new o({x:0,y:0}):this.scale(1/t)},o.prototype.direction=function(t){var n=new o(t).subtract({x:this.x,y:this.y}),e=n.magnitude();return e<=0?new o({x:1,y:0}):n.scale(1/e)},o.prototype.equal=function(t){return this.x===t.x&&this.y===t.y},o.prototype.rotate=function(t){return new o({x:Math.cos(t)*this.x-Math.sin(t)*this.y,y:Math.sin(t)*this.x+Math.cos(t)*this.y})},o.prototype.rotateDeg=function(t){var n=r(t);return this.rotate(n)},o.prototype.dist=function(t){return this.subtract(t).magnitude()},o.prototype.distSq=function(t){var n=this.subtract(t);return n.dot({x:n.x,y:n.y})},o.prototype.clone=function(){return new o({x:this.x,y:this.y})},o.prototype.get=function(){return{x:this.x,y:this.y}}}])})}])});